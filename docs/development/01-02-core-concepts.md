# 核心理念与设计原则

> 本文档阐述 Turbo AI Rules 的核心设计理念和指导原则。

---

## 1. 核心理念

### 1.1 桥接模式 (Bridge Pattern)

本扩展作为**外部规则仓库**和**AI 工具配置文件**之间的桥梁：

```
Git 规则仓库 ──→ [Turbo AI Rules] ──→ AI 工具配置文件
(统一 MDC 格式)     (解析/转换/合并)      (各工具特定格式)
```

**职责分离**:

- **规则仓库**: 负责规则定义和版本管理
- **扩展**: 负责同步、解析、转换、合并
- **AI 工具**: 负责读取配置并应用规则

### 1.2 分离关注点 (Separation of Concerns)

**三层分离**:

- **规则定义层**: MDC 格式 (Markdown + YAML Frontmatter)，存储在 Git 仓库
- **规则管理层**: 扩展负责同步、索引、搜索、冲突解决
- **规则适配层**: 适配器模式，每个 AI 工具有独立适配器

**好处**:

- 规则定义与工具无关，易于复用
- 管理逻辑集中，便于维护
- 适配器独立，易于扩展新工具

### 1.3 适配器模式 (Adapter Pattern)

每个 AI 工具对应一个适配器，负责：

- 读取合并后的规则集合
- 转换为目标工具的格式
- 生成配置文件
- 验证配置有效性

**扩展性**:

- 新增 AI 工具只需添加新适配器
- 不影响现有适配器
- 支持用户自定义适配器

---

## 2. 设计原则

### 2.1 约定优于配置 (Convention over Configuration)

**默认行为**:

- 全局缓存路径: `~/.turbo-ai-rules/sources/`
- 项目本地路径: `.ai-rules/`
- 自动添加到 `.gitignore`
- 默认启用 GitHub Copilot 适配器

**可配置项**:

- 只在必要时要求用户配置
- 提供合理的默认值
- 支持高级用户深度定制

### 2.2 渐进式增强 (Progressive Enhancement)

**核心功能**:

- 基础: 添加源、同步规则、生成配置
- 中级: 规则选择、冲突解决、搜索
- 高级: 自定义适配器、规则验证、统计分析

**学习曲线**:

- 新手: 使用默认配置即可快速上手
- 进阶: 逐步了解更多功能
- 专家: 完全掌控所有细节

### 2.3 数据本地优先 (Local-First)

**存储策略**:

- 所有数据本地存储
- 不依赖外部服务
- 离线可用

**隐私保护**:

- 不上传用户规则
- 不收集使用数据
- Git 凭据本地加密存储

### 2.4 单一数据源 (Single Source of Truth)

**规则源**:

- Git 仓库是规则的唯一数据源
- 本地缓存和生成的配置都来源于规则源
- 不在本地编辑规则，保持与源同步

**好处**:

- 避免数据不一致
- 简化同步逻辑
- 便于团队协作

### 2.5 最小惊讶原则 (Principle of Least Astonishment)

**行为一致性**:

- 操作结果符合用户预期
- 错误提示清晰友好
- 撤销和回滚机制

**交互设计**:

- 遵循 VSCode 设计规范
- 保持与 VSCode 原生组件一致的行为
- 快捷键和右键菜单符合习惯

---

## 3. 技术原则

### 3.1 模块化设计

- 每个模块单一职责
- 模块间松耦合
- 通过接口交互

### 3.2 错误处理

- 所有异步操作都要有错误处理
- 错误分类和编码（TAI-xxxx）
- 友好的错误提示和恢复建议

### 3.3 性能优化

- 全局缓存避免重复下载
- 增量同步减少数据传输
- 异步操作不阻塞 UI

### 3.4 安全性

- 输入验证和清理
- 路径规范化防止目录穿越
- Git 凭据加密存储
- 不在日志中输出敏感信息

### 3.5 可测试性

- 依赖注入便于 Mock
- 单元测试覆盖核心逻辑
- 集成测试验证端到端流程

---

## 4. 设计权衡

### 4.1 简单 vs 功能丰富

**选择**: 优先简单易用

- 默认配置覆盖 80% 场景
- 高级功能不影响基础使用
- 渐进式揭示复杂性

### 4.2 性能 vs 易维护

**选择**: 优先易维护

- 清晰的代码结构
- 避免过早优化
- 性能瓶颈再针对性优化

### 4.3 灵活 vs 约束

**选择**: 合理约束，关键处灵活

- 规则格式统一（MDC）
- 存储位置约定
- 适配器可自定义扩展

---

> **返回**: [01-design.md](./01-design.md) - 产品整体设计
