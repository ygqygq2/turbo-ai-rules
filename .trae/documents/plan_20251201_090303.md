# Source Manager 页面实现计划

## 1. 设计文档和 HTML 生成

### 1.1 设计文档

* 已存在：`.superdesign/design_docs/14-source-manager-page.md`

* 检查并确保设计文档完整，包含所有必要的设计细节

### 1.2 设计 HTML 文件

* 生成路径：`.superdesign/design_iterations/14-source-manager-page_1.html`

* 包含完整的 HTML/CSS 实现

* 使用 VS Code CSS 变量（`var(--vscode-*)`）

* 实现左右分栏布局

* 包含所有交互状态（空状态、详情视图、编辑视图）

## 2. React 组件实现

### 2.1 目录结构

```
src/webview/source-manager/
├── App.tsx                    # 主应用组件
├── SourceManager.tsx          # 主页面组件
├── SourceList.tsx             # 左侧规则源列表
├── SourceDetails.tsx          # 右侧详情视图
├── SourceForm.tsx             # 编辑表单（复用/修改现有组件）
├── index.tsx                  # 入口文件
├── index.html                 # HTML 模板
└── source-manager.css         # 样式文件
```

### 2.2 组件设计

#### SourceManager.tsx

* 主容器组件

* 管理左右分栏布局

* 处理状态管理（选中的规则源、当前视图模式）

* 处理消息通信

#### SourceList.tsx

* 规则源列表组件

* 显示规则源名称、状态、规则数量

* 支持选中、编辑、删除、启用/禁用操作

* 支持键盘导航

#### SourceDetails.tsx

* 规则源详情组件

* 显示规则源的详细信息

* 包含操作按钮（编辑、删除、同步）

#### SourceForm.tsx

* 规则源编辑表单

* 复用现有的 SourceForm 组件或修改为可复用组件

* 支持创建和编辑模式

## 3. Webview Provider 实现

### 3.1 创建 SourceManagerWebviewProvider

* 路径：`src/providers/SourceManagerWebviewProvider.ts`

* 继承 BaseWebviewProvider

* 实现消息处理逻辑

* 实现与扩展的通信

### 3.2 注册命令

* 在 `extension.ts` 中注册命令 `turboAiRules.openSourceManager`

* 添加到命令面板和上下文菜单

## 4. 消息通信实现

### 4.1 Extension → Webview

* `init`：初始化数据

* `sourceDetails`：规则源详细信息

* `syncCompleted`：同步完成

* `operationResult`：操作结果

### 4.2 Webview → Extension

* `ready`：Webview 准备就绪

* `selectSource`：选中规则源

* `addSource`：添加规则源

* `editSource`：编辑规则源

* `deleteSource`：删除规则源

* `toggleSource`：启用/禁用规则源

* `syncSource`：立即同步

* `viewInExplorer`：在规则树中查看

## 5. 样式和组件复用

### 5.1 复用现有样式

* `global.css`：全局样式

* `common/components`：通用组件（Button、Card、EmptyState 等）

### 5.2 复用现有组件

* `SourceForm`：修改为可复用组件

* `ErrorBoundary`：错误边界

* `i18n`：国际化支持

## 6. 测试和验证

### 6.1 功能测试

* 添加规则源

* 编辑规则源

* 删除规则源

* 启用/禁用规则源

* 立即同步

* 查看详情

### 6.2 无障碍测试

* 键盘导航

* ARIA 属性

* 屏幕阅读器支持

### 6.3 性能测试

* 规则源列表渲染性能

* 表单验证性能

## 7. 集成到扩展

### 7.1 更新 extension.ts

* 注册 SourceManagerWebviewProvider

* 注册命令

* 添加到激活事件

### 7.2 更新 package.json

* 添加必要的依赖（如果有）

* 更新贡献点

## 8. 文档更新

### 8.1 实现文档

* 路径：`docs/development/webview/14-source-manager-page-implementation.md`

* 记录实现细节

* 包含组件结构和数据流

* 记录遇到的问题和解决方案

### 8.2 用户文档

* 更新用户指南，添加 Source Manager 页面的使用说明

## 实现顺序

1. 生成设计 HTML 文件
2. 创建 React 组件目录结构
3. 实现 SourceList 和 SourceDetails 组件
4. 实现或修改 SourceForm 组件
5. 实现 SourceManager 主组件
6. 创建 SourceManagerWebviewProvider
7. 注册命令和更新 extension.ts
8. 测试和验证
9. 更新文档

## 技术要点

* 使用 React 函数组件和 Hooks

* 使用 TypeScript 确保类型安全

* 遵循 VS Code 扩展开发最佳实践

* 使用 VS Code CSS 变量实现主题自适应

* 实现无障碍支持

* 确保性能

