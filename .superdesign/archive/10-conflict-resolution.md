# 10 - 规则冲突解决（设计文档）

> 状态：设计（无实现细节）  
> 版本：3.0  
> 最后更新：2025-11-10

---

## 目标与范围

- 在同步/解析后对规则冲突（ID/标题等）进行可视化展示与一键处理。
- 兼容扩展的冲突策略：`priority | merge | skip-duplicates`。
- 生成可被生成器与索引消费的“解决方案”记录（持久化到工作区数据目录）。

---

## 入口

- 同步完成后检测到冲突 → 通知/状态栏提供「查看冲突」入口。
- 统计仪表板（02）概览卡片点击跳转。
- 命令面板：`Turbo AI Rules: Resolve Conflicts`。

---

## 页面结构

- 顶部：统计摘要（冲突数量、类型分布、受影响源/规则数）。
- 主列表：按冲突分组（以 ruleId 或 title 聚合）。
  - 每组包含：来源源名、版本、优先级、标签、路径、时间。
  - 推荐方案标记（基于当前全局策略）。
- 右侧面板：
  - 方案说明：为何推荐、影响面、可逆性。
  - 操作：
    - 采用推荐方案
    - 选择具体规则（单选）
    - 合并（打开 09 编辑器预置合并草稿）
    - 跳过（保留第一个）

---

## 关键流程

1. 加载与过滤

- 支持按源、优先级、标签、类型过滤。
- 默认按严重度排序（high > medium > low / 重复 ID > 重复标题）。

2. 选择方案

- 单条冲突可独立选择方案；支持“全部采用推荐”。
- 选择后立即保存到“解决方案表”（工作区数据）。

3. 应用与回滚

- 在下一次“配置生成”阶段读取方案表应用决策。
- 提供「清空方案」「恢复默认策略」操作。

---

## 状态与边界

- 无冲突状态：展示空态与返回入口。
- 长列表性能：分页/虚拟列表（由实现决定）。
- 权限：只读工作区展示警告，不允许写方案（极端场景）。

---

## 消息协议（概念层）

- `conflicts/load`: 加载冲突数据。
- `conflicts/filter`: 设置过滤条件。
- `conflicts/select-solution`: 选择具体方案。
- `conflicts/apply-all`: 批量采用推荐方案。
- `conflicts/clear`: 清空方案表。

---

## 验收标准

- 能完整展示冲突并支持单条/批量处理；
- 方案可被生成器消费且对生成结果生效；
- 方案持久化，重启后仍在；
- i18n/无障碍合规。
