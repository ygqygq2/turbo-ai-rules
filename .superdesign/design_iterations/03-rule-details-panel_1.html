<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'none'; style-src 'unsafe-inline' https://microsoft.github.io; font-src https://microsoft.github.io; script-src 'nonce-{{nonce}}';"
    />
    <title>Rule Details</title>
    <style>
      :root {
        /* VS Code ä¸»é¢˜å˜é‡ - æš—è‰²ä¸»é¢˜é»˜è®¤å€¼ï¼ˆç”¨äºæµè§ˆå™¨é¢„è§ˆï¼‰*/
        --vscode-font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica,
          Arial, sans-serif;
        --vscode-font-weight: 400;
        --vscode-font-size: 13px;
        --vscode-foreground: #cccccc;
        --vscode-descriptionForeground: #8c8c8c;
        --vscode-errorForeground: #f48771;
        --vscode-editorWarning-foreground: #cca700;

        /* èƒŒæ™¯è‰² */
        --vscode-editor-background: #1e1e1e;
        --vscode-editorWidget-background: #252526;
        --vscode-sideBar-background: #252526;
        --vscode-input-background: #3c3c3c;

        /* è¾¹æ¡† */
        --vscode-editorWidget-border: #454545;
        --vscode-sideBar-border: #333333;
        --vscode-focusBorder: #007fd4;

        /* æŒ‰é’® */
        --vscode-button-background: #0e639c;
        --vscode-button-foreground: #ffffff;
        --vscode-button-hoverBackground: #1177bb;
        --vscode-button-secondaryBackground: #3a3d41;
        --vscode-button-secondaryForeground: #ffffff;
        --vscode-button-secondaryHoverBackground: #45494e;

        /* åˆ—è¡¨ */
        --vscode-list-hoverBackground: #2a2d2e;
        --vscode-list-activeSelectionBackground: #094771;
        --vscode-list-activeSelectionForeground: #ffffff;
        --vscode-list-inactiveSelectionBackground: #37373d;

        /* å›¾è¡¨é¢œè‰² */
        --vscode-charts-green: #89d185;
        --vscode-charts-blue: #75beff;
        --vscode-charts-yellow: #cca700;
        --vscode-charts-red: #f48771;
        --vscode-charts-purple: #b180d7;

        /* å…¶ä»– */
        --vscode-badge-background: #4d4d4d;
        --vscode-badge-foreground: #ffffff;
        --vscode-checkbox-background: #3c3c3c;
        --vscode-checkbox-border: #6c6c6c;
        --vscode-checkbox-foreground: #f0f0f0;
        --vscode-icon-foreground: #c5c5c5;
        --vscode-textLink-foreground: #3794ff;
        --vscode-toolbar-hoverBackground: #2a2d2e;

        /* é—´è·ç³»ç»Ÿ */
        --spacing-xs: 4px;
        --spacing-sm: 8px;
        --spacing-md: 12px;
        --spacing-lg: 16px;
        --spacing-xl: 20px;
        --border-radius: 4px;
      }

      body {
        font-family: var(--vscode-font-family);
        font-weight: var(--vscode-font-weight);
        font-size: var(--vscode-font-size);
        color: var(--vscode-foreground);
        background-color: var(--vscode-editor-background);
        padding: var(--spacing-md);
        box-sizing: border-box;
      }

      .details-container {
        animation: slideInRight 0.3s ease-out;
      }

      .header {
        position: sticky;
        top: 0;
        background-color: var(--vscode-editorWidget-background);
        z-index: 10;
      }

      .title-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-md);
        border-bottom: 1px solid var(--vscode-editorWidget-border, transparent);
      }

      .title-section {
        display: flex;
        align-items: baseline;
        gap: var(--spacing-sm);
      }

      .title-section h1 {
        font-size: 20px;
        font-weight: 600;
        margin: 0;
      }

      .rule-id {
        font-size: 14px;
        color: var(--vscode-descriptionForeground);
        font-weight: 400;
      }

      .toolbar {
        display: flex;
        gap: var(--spacing-sm);
      }

      .button {
        border: 1px solid transparent;
        padding: 6px 12px;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 13px;
        font-family: var(--vscode-font-family);
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .button-primary {
        background-color: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
      }

      .button-primary:hover {
        background-color: var(--vscode-button-hoverBackground);
      }

      .button-secondary {
        background-color: var(--vscode-button-secondaryBackground);
        color: var(--vscode-button-secondaryForeground);
      }

      .button-secondary:hover {
        background-color: var(--vscode-button-secondaryHoverBackground);
      }

      .button-icon {
        background: none;
        border: none;
        color: var(--vscode-foreground);
        padding: 4px 8px;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 13px;
      }

      .button-icon:hover {
        background-color: var(--vscode-toolbar-hoverBackground);
      }

      /* Emoji å›¾æ ‡æ ·å¼ */
      .emoji-icon {
        font-family: 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif;
        font-style: normal;
        font-size: 14px;
      }

      .section {
        padding: var(--spacing-md);
        border-bottom: 1px solid var(--vscode-editorWidget-border, transparent);
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-sm);
      }

      .section-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--vscode-descriptionForeground);
        margin: 0 0 var(--spacing-sm) 0;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .content-actions {
        display: flex;
        gap: var(--spacing-xs);
      }

      .code-block {
        background-color: var(--vscode-editor-background);
        border: 1px solid var(--vscode-editorWidget-border);
        border-radius: var(--border-radius);
        padding: var(--spacing-md);
        margin: 0;
        overflow-x: auto;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 13px;
        line-height: 1.6;
      }

      .code-block code {
        padding: 0;
        background: none;
      }

      .rendered-content {
        background-color: var(--vscode-editor-background);
        border: 1px solid var(--vscode-editorWidget-border);
        border-radius: var(--border-radius);
        padding: var(--spacing-md);
        line-height: 1.6;
      }

      .rendered-content h1,
      .rendered-content h2,
      .rendered-content h3 {
        margin-top: var(--spacing-md);
        margin-bottom: var(--spacing-sm);
        color: var(--vscode-foreground);
      }

      .rendered-content h1 {
        font-size: 1.5em;
      }

      .rendered-content h2 {
        font-size: 1.3em;
      }

      .rendered-content h3 {
        font-size: 1.1em;
      }

      .rendered-content p {
        margin: var(--spacing-sm) 0;
      }

      .rendered-content code {
        background-color: var(--vscode-textCodeBlock-background);
        color: var(--vscode-textPreformat-foreground);
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 0.9em;
      }

      .rendered-content pre {
        background-color: var(--vscode-textCodeBlock-background);
        border: 1px solid var(--vscode-editorWidget-border);
        border-radius: var(--border-radius);
        padding: var(--spacing-md);
        overflow-x: auto;
        margin: var(--spacing-sm) 0;
      }

      .rendered-content pre code {
        background: none;
        padding: 0;
      }

      .metadata-grid {
        display: grid;
        grid-template-columns: 120px 1fr;
        gap: var(--spacing-sm);
        font-size: 13px;
      }

      .metadata-label {
        color: var(--vscode-descriptionForeground);
      }
      .metadata-value {
        word-break: break-all;
      }

      .priority-text {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 0.95em;
        font-weight: 600;
      }

      .priority-high {
        color: var(--vscode-errorForeground);
      }

      .priority-medium {
        color: var(--vscode-editorWarning-foreground);
      }

      .priority-low {
        color: var(--vscode-charts-blue);
      }

      .tag-cloud {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-sm);
      }

      .tag {
        display: inline-block;
        background: linear-gradient(
          135deg,
          var(--vscode-badge-background) 0%,
          color-mix(in srgb, var(--vscode-badge-background) 80%, var(--vscode-charts-blue) 20%) 100%
        );
        color: var(--vscode-badge-foreground);
        padding: 6px 12px;
        border-radius: 12px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      }
      .tag:hover {
        background: linear-gradient(
          135deg,
          var(--vscode-charts-blue) 0%,
          color-mix(in srgb, var(--vscode-charts-blue) 70%, var(--vscode-charts-purple) 30%) 100%
        );
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
      }

      .content-preview {
        padding: 0 var(--spacing-md) var(--spacing-md) var(--spacing-md);
        font-family: var(--vscode-editor-font-family);
        line-height: 1.6;
      }
      .content-preview.no-wrap {
        white-space: pre;
        overflow-x: auto;
      }
      .content-preview h1,
      .content-preview h2,
      .content-preview h3 {
        margin-top: 1.5em;
        margin-bottom: 0.5em;
        font-weight: 600;
      }
      .content-preview h1 {
        font-size: 1.8em;
      }
      .content-preview h2 {
        font-size: 1.5em;
      }
      .content-preview h3 {
        font-size: 1.2em;
      }
      .content-preview code {
        background-color: var(--vscode-textCodeBlock-background);
        padding: 2px 4px;
        border-radius: 3px;
        font-family: var(--vscode-editor-font-family);
      }
      .content-preview pre {
        background-color: var(--vscode-textCode-background);
        padding: var(--spacing-md);
        border-radius: var(--border-radius);
        overflow-x: auto;
      }
      .content-preview pre code {
        padding: 0;
        background: none;
      }

      @keyframes slideInRight {
        from {
          opacity: 0;
          transform: translateX(20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
    </style>
  </head>
  <body>
    <div class="details-container">
      <header class="header">
        <div class="title-bar">
          <div class="title-section">
            <h1 id="rule-name">Go æœ€ä½³å®è·µ</h1>
            <div class="rule-id">#104</div>
          </div>
          <div class="toolbar" role="toolbar" aria-label="Rule actions">
            <button
              class="button button-primary"
              onclick="sendMessage('openMarkdownPreview')"
              aria-label="Preview markdown"
              title="Open in VSCode Markdown preview"
            >
              <span class="emoji-icon">ğŸ‘ï¸</span> Preview
            </button>
            <button
              class="button button-primary"
              onclick="sendMessage('copyContent')"
              aria-label="Copy content"
              title="Copy content"
            >
              <span class="emoji-icon">ğŸ“‹</span> Copy
            </button>
            <button
              class="button button-primary"
              onclick="sendMessage('exportRule')"
              aria-label="Export rule"
              title="Export rule"
            >
              <span class="emoji-icon">ğŸ“¥</span> Export
            </button>
            <button
              class="button button-secondary"
              onclick="sendMessage('openInEditor')"
              aria-label="Edit in editor"
              title="Open in editor"
            >
              <span class="emoji-icon">ğŸ“</span> Edit
            </button>
          </div>
        </div>
      </header>

      <main>
        <section class="section">
          <h2 class="section-title">ğŸ“Š Metadata</h2>
          <div class="metadata-grid">
            <div class="metadata-label">SOURCE</div>
            <div class="metadata-value" id="meta-source">ai-rules-7008d805</div>
            <div class="metadata-label">FILE PATH</div>
            <div class="metadata-value" id="meta-path">
              /home/ygqygq2/.cache/turbo-ai-rules/sources/ai-rules-7008d805/100-programming-languages/104-go.mdc
            </div>
            <div class="metadata-label">VERSION</div>
            <div class="metadata-value" id="meta-version">1.0.0</div>
            <div class="metadata-label">AUTHOR</div>
            <div class="metadata-value" id="meta-author">Turbo AI Rules</div>
            <div class="metadata-label">PRIORITY</div>
            <div class="metadata-value">
              <span class="priority-text priority-medium"
                ><span class="emoji-icon">â­</span> <span>medium</span></span
              >
            </div>
          </div>
        </section>

        <section class="section">
          <h2 class="section-title">ğŸ“ Description</h2>
          <p id="description">Go 1.21+ ç°ä»£åº”ç”¨å¼€å‘çš„å‡½æ•°å¼æˆ‘ä»¬ä¿¡ç”¨æ¨¡å¼</p>
        </section>

        <section class="section">
          <h2 class="section-title">ğŸ·ï¸ Tags</h2>
          <div class="tag-cloud" id="tag-cloud">
            <span class="tag" tabindex="0">go</span>
            <span class="tag" tabindex="0">golang</span>
            <span class="tag" tabindex="0">backend</span>
            <span class="tag" tabindex="0">concurrency</span>
            <span class="tag" tabindex="0">microservices</span>
          </div>
        </section>

        <section class="section">
          <div class="section-header">
            <h2 class="section-title"><span class="emoji-icon">ğŸ“„</span> Content Preview</h2>
            <div class="content-actions">
              <button
                class="button-icon"
                onclick="toggleContentView()"
                title="Toggle between raw and rendered view"
                id="view-toggle-btn"
              >
                <span id="view-toggle-text">ğŸ”„ Render</span>
              </button>
              <button class="button-icon" onclick="sendMessage('copyContent')" title="Copy content">
                <span class="emoji-icon">ğŸ“‹</span>
              </button>
            </div>
          </div>
          <div id="content-area">
            <pre class="code-block"><code># Go æœ€ä½³å®è·µ

## é€‚ç”¨åœºæ™¯

- Go 1.21+ åº”ç”¨å¼€å‘
- ç»“æ„æœåŠ¡å¼€å‘
- å¾®æœåŠ¡æ¶æ„
- å‘½ä»¤è¡Œå·¥å…·
- å¹¶å‘ç¼–ç¨‹
- äº‘åŸç”Ÿåº”ç”¨

## æ ¸å¿ƒå†…å®¹

Go å¼€å‘çš„æ ¸å¿ƒåŸåˆ™å’Œæœ€ä½³å®è·µï¼Œæ¶µç›–å¹¶å‘ç¼–ç¨‹ã€ä»£ç é£æ ¼ã€å¹¶å‘é£æ ¼ã€æ€§èƒ½ä¼˜åŒ–ã€å¹¶ä¸”ç¼–ç¨‹å®è·µã€‚

## å…³é”®è¦ç‚¹</code></pre>
          </div>
        </section>
      </main>
    </div>

    <script nonce="{{nonce}}">
      const vscode = acquireVsCodeApi();
      let isRenderedView = false;
      let renderedHtml = null;

      function sendMessage(type, payload) {
        vscode.postMessage({ type, payload });

        // æŒ‰é’®ç‚¹å‡»åé¦ˆ
        const button = event.target.closest('.button, .button-icon');
        if (button) {
          button.style.opacity = '0.6';
          setTimeout(() => {
            button.style.opacity = '1';
          }, 200);
        }

        // ç‰¹æ®Šå¤„ç†å¤åˆ¶æ“ä½œ
        if (type === 'copyContent') {
          showCopyFeedback(button);
        }
      }

      function toggleContentView() {
        // å¦‚æœè¦åˆ‡æ¢åˆ°æ¸²æŸ“è§†å›¾ä¸”è¿˜æ²¡æœ‰æ¸²æŸ“å†…å®¹
        if (!isRenderedView && renderedHtml === null) {
          vscode.postMessage({ type: 'renderMarkdown' });
          // ä¸ç«‹å³åˆ‡æ¢è§†å›¾ï¼Œç­‰å¾…æ¸²æŸ“å®Œæˆåå†åˆ‡æ¢
          return;
        }

        // å¦‚æœå·²æœ‰æ¸²æŸ“å†…å®¹æˆ–è¦åˆ‡å›åŸå§‹è§†å›¾ï¼Œç«‹å³åˆ‡æ¢
        isRenderedView = !isRenderedView;
        updateContentView();
      }

      function updateContentView() {
        const contentArea = document.getElementById('content-area');
        const toggleText = document.getElementById('view-toggle-text');

        if (!isRenderedView) {
          // æ˜¾ç¤ºåŸå§‹å†…å®¹
          toggleText.textContent = 'ğŸ”„ Render';
          const rule = JSON.parse(localStorage.getItem('currentRule') || '{}');
          contentArea.innerHTML = `<pre class="code-block"><code>${escapeHtml(
            rule.content || '',
          )}</code></pre>`;
        } else {
          // æ˜¾ç¤ºæ¸²æŸ“åçš„å†…å®¹
          toggleText.textContent = 'ğŸ“ Raw';
          contentArea.innerHTML = `<div class="rendered-content">${renderedHtml || ''}</div>`;
        }
      }

      function escapeHtml(text) {
        const map = {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#039;',
        };
        return text.replace(/[&<>"']/g, (m) => map[m]);
      }

      function showCopyFeedback(button) {
        if (!button) return;
        const originalContent = button.innerHTML;
        button.innerHTML = '<span class="emoji-icon">âœ…</span>';
        button.disabled = true;

        setTimeout(() => {
          button.innerHTML = originalContent;
          button.disabled = false;
        }, 2000);
      }

      // æ ‡ç­¾ç‚¹å‡»äº‹ä»¶
      document.addEventListener('DOMContentLoaded', () => {
        const tags = document.querySelectorAll('.tag');
        tags.forEach((tag) => {
          tag.addEventListener('click', () => {
            const tagName = tag.textContent.trim();
            sendMessage('searchByTag', { tag: tagName });
          });

          // é”®ç›˜æ”¯æŒ
          tag.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              tag.click();
            }
          });
        });

        // å‘é€ webview ready æ¶ˆæ¯
        vscode.postMessage({ type: 'webviewReady' });
      });

      window.addEventListener('message', (event) => {
        const message = event.data;

        if (message.type === 'setRule') {
          const rule = message.rule;

          // ä¿å­˜å½“å‰è§„åˆ™
          localStorage.setItem('currentRule', JSON.stringify(rule));

          // æ›´æ–°æ ‡é¢˜
          document.getElementById('rule-name').textContent = rule.title || 'Unnamed Rule';
          document.querySelector('.rule-id').textContent = `#${rule.id || ''}`;

          // æ›´æ–°å…ƒæ•°æ®
          document.getElementById('meta-source').textContent = rule.sourceId || 'N/A';
          document.getElementById('meta-path').textContent = rule.filePath || 'N/A';
          document.getElementById('meta-version').textContent = rule.metadata?.version || '1.0.0';
          document.getElementById('meta-author').textContent = rule.metadata?.author || 'N/A';

          // æ›´æ–°ä¼˜å…ˆçº§
          const priorityElem = document.querySelector('.metadata-value .priority-text');
          if (priorityElem) {
            const priority = rule.metadata?.priority || 'medium';
            priorityElem.className = `priority-text priority-${priority.toLowerCase()}`;

            const iconMap = {
              high: 'ğŸ”¥',
              medium: 'â­',
              low: 'â„¹ï¸',
            };
            priorityElem.innerHTML = `<span class="emoji-icon">${
              iconMap[priority.toLowerCase()]
            }</span> <span>${priority}</span>`;
          }

          // æ›´æ–°æè¿°
          document.getElementById('description').textContent =
            rule.metadata?.description || 'No description available.';

          // æ›´æ–°æ ‡ç­¾
          const tagCloud = document.getElementById('tag-cloud');
          if (rule.metadata?.tags && rule.metadata.tags.length > 0) {
            tagCloud.innerHTML = rule.metadata.tags
              .map((tag) => `<span class="tag" tabindex="0">${tag}</span>`)
              .join('');
          } else {
            tagCloud.innerHTML = '<span class="metadata-value">No tags</span>';
          }

          // æ›´æ–°å†…å®¹é¢„è§ˆ
          const contentArea = document.getElementById('content-area');
          contentArea.innerHTML = `<pre class="code-block"><code>${escapeHtml(
            rule.content || '',
          )}</code></pre>`;

          // é‡ç½®æ¸²æŸ“çŠ¶æ€
          isRenderedView = false;
          renderedHtml = null;
          document.getElementById('view-toggle-text').textContent = 'ğŸ”„ Render';
        }

        if (message.type === 'renderedHtml') {
          renderedHtml = message.html;
          // æ¸²æŸ“å®Œæˆåè‡ªåŠ¨åˆ‡æ¢åˆ°æ¸²æŸ“è§†å›¾
          isRenderedView = true;
          updateContentView();
        }
      });
    </script>
  </body>
</html>
