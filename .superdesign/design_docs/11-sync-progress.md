# 11 - 同步进度面板（设计文档）

> 状态：设计（无实现细节）  
> 版本：3.0  
> 最后更新：2025-11-10

---

## 目标与范围

- 将“同步”全过程（拉取/解析/合并/生成/写入）以阶段化进度展示，便于用户理解卡在哪一步。
- 支持错误快速定位、重试、跳转到相关页面（冲突/详情）。

---

## 入口

- 触发同步时自动显示（可配置）；
- 状态栏菜单项「查看同步详情」。

---

## 阶段与指标

1. 准备与配置验证
2. Git 获取（clone/pull/checkout）
3. 规则解析与校验（计数：成功/失败、耗时）
4. 合并与冲突检测（计数：冲突数、策略）
5. 配置生成（目标工具与文件计数）
6. 写入与清理（原子写入、保护策略）

每阶段：进度条、耗时、可展开日志（结构化，隐藏敏感信息）。

---

## 页面结构

- 顶部：全局进度与剩余时间估计。
- 列表：阶段卡片（可展开）。
- 右上角：重试/取消同步/复制诊断信息。
- 底部：最近一次同步结果摘要（时间、成功/失败、异常计数）。

---

## 状态与边界

- 可取消（发送取消信号，优雅中止）。
- 失败重试（只重试失败阶段，按实现能力决定）。
- 大仓库测速与节流提示。

---

## 消息协议（概念层）

- `sync/start`: 开始同步（含源范围）。
- `sync/progress`: 阶段性进度（stage, percent, stats）。
- `sync/result`: 完成结果（ok/err, details）。
- `sync/cancel`: 取消请求。
- `sync/open-conflicts`: 跳转到冲突页面。

---

## 验收标准

- 阶段进度清晰可感知；
- 错误可定位并可复制诊断信息；
- 与冲突页面联动；
- i18n/无障碍合规。
